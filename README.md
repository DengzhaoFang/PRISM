<div align="center">
  <img src="data:image/png;base64,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" width="120" />
  <h1>PRISM: Purified Representation and Integrated Semantic Modeling</h1>
</div>

A novel generative sequential recommendation framework that addresses tokenization quality and information loss through purified semantic quantization and integrated semantic modeling.

## Quick Start

### 1. Data Preprocessing

Process raw Amazon review data with 5-core filtering and generate semantic embeddings:

```bash
cd data
python process_amazon.py \
    --dataset Beauty \
    --review_path ../dataset/Amazon-Beauty/reviews_Beauty.json.gz \
    --meta_path ../dataset/Amazon-Beauty/meta_Beauty.json.gz \
    --output_dir ../dataset/Amazon-Beauty/processed/beauty-prism-sentenceT5base \
    --min_interactions 5 \
    --embed_mode prism \
    --embed_model sentence-t5 \
    --device cuda:0
```

**Other datasets**: Replace `Beauty` with `CDs`, `Sports`, or `Toys` and adjust paths accordingly.

### 2. Training PRISM

#### (1) Train Tokenizer (Purified Semantic Quantizer)

```bash
cd src/sid_tokenizer/prism
python train_prism.py \
    --data_path ../../../dataset/Amazon-Beauty/processed/beauty-prism-sentenceT5base/Beauty \
    --output_dir ../../../scripts/output/prism_tokenizer/beauty \
    --n_layers 3 \
    --n_embed_per_layer "256,256,256" \
    --latent_dim 32 \
    --epochs 500 \
    --batch_size 512 \
    --learning_rate 1e-4 \
    --use_ema \
    --device cuda
```

Or use the provided script:
```bash
bash scripts/prism/train_prism_beauty.sh
```

#### (2) Train Recommender (Integrated Semantic Recommender)

```bash
cd <project_root>
python -m src.recommender.prism.train \
    --config beauty \
    --device cuda:0 \
    --model_type t5-tiny-2 \
    --use_multimodal_fusion \
    --use_codebook_prediction \
    --use_trie_constraints
```

Or use the provided script:
```bash
bash scripts/prism/train_recommender.sh
```

### 3. Running Baselines

Example: Training TIGER baseline

#### (1) Train TIGER Tokenizer
```bash
cd src/sid_tokenizer/rq-base
python train_tokenizer.py \
    --data_path ../../../dataset/Amazon-Beauty/processed/beauty-tiger-sentenceT5base/Beauty \
    --output_dir ../../../scripts/output/tiger_tokenizer/beauty \
    --mode tiger \
    --n_layers 3 \
    --n_embed 256 \
    --latent_dim 32 \
    --epochs 500 \
    --batch_size 512 \
    --use_ema \
    --device cuda
```

Or use script: `bash scripts/TIGER/train_tiger_beauty.sh`

#### (2) Train TIGER Recommender
```bash
cd <project_root>
python -m src.recommender.TIGER.train \
    --config beauty \
    --device cuda:0 \
    --model_type t5-tiny-2
```

Or use script: `bash scripts/TIGER/train_recommender.sh`

**Other baselines**: Replace `TIGER` with `EAGER`, `LETTER`, or `ActionPiece` in the paths above.

## Project Structure

```
├── data/                    # Data preprocessing scripts
├── dataset/                 # Raw and processed datasets
├── src/
│   ├── sid_tokenizer/      # Tokenizer implementations
│   │   ├── prism/          # PRISM tokenizer
│   │   ├── rq-base/        # Baseline tokenizers (TIGER, etc.)
│   │   └── ...
│   └── recommender/        # Recommender implementations
│       ├── prism/          # PRISM recommender
│       └── ...
└── scripts/                # Training scripts
    ├── prism/
    ├── TIGER/
    └── ...
```

